// REPLACE lines 83-131 in MoveFrequencyTree.cs with this:

                System.Diagnostics.Debug.WriteLine($"[STEP1] Opening file: {filePath}");
                using (var reader = new StreamReader(filePath))
                {
                    string? line;
                    int linesRead = 0;

                    while ((line = reader.ReadLine()) != null)
                    {
                        linesRead++;
                        if (linesRead % 1000000 == 0)
                        {
                            System.Diagnostics.Debug.WriteLine($"[STEP1] Read {linesRead:N0} lines, {totalGames:N0} games, {chunkPgnFiles.Count} chunks created");
                        }

                        if (line.StartsWith("[Event "))
                        {
                            // Start new chunk file if needed
                            if (currentChunkWriter == null || currentChunkGames >= chunkSize)
                            {
                                currentChunkWriter?.Close();
                                chunkNumber++;
                                string chunkFile = Path.Combine(tempDir, $"chunk_{chunkNumber:D4}.pgn");
                                chunkPgnFiles.Add(chunkFile);
                                currentChunkWriter = new StreamWriter(chunkFile);
                                currentChunkGames = 0;
                                
                                if (chunkNumber % 10 == 0)
                                {
                                    System.Diagnostics.Debug.WriteLine($"[STEP1] Created chunk file {chunkNumber}");
                                }
                            }

                            totalGames++;
                            currentChunkGames++;
                        }

                        // CRITICAL FIX: Write EVERY line (tags, blank, moves, blank)
                        currentChunkWriter?.WriteLine(line);
                    }
                }

                currentChunkWriter?.Close();
